<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="How Azure Cloud Shell stores your files"><title>How Azure Cloud Shell stores your files</title>
<link rel=canonical href=https://www.bathysphere.org/p/how-azure-cloud-shell-stores-your-files/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="How Azure Cloud Shell stores your files"><meta property='og:description' content="How Azure Cloud Shell stores your files"><meta property='og:url' content='https://www.bathysphere.org/p/how-azure-cloud-shell-stores-your-files/'><meta property='og:site_name' content='Bathysphere.org'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Azure'><meta property='article:tag' content='CloudShell'><meta property='article:published_time' content='2021-05-25T00:00:00+00:00'><meta property='article:modified_time' content='2021-05-25T00:00:00+00:00'><meta property='og:image' content='https://www.bathysphere.org/p/how-azure-cloud-shell-stores-your-files/csfiles.png'><meta name=twitter:title content="How Azure Cloud Shell stores your files"><meta name=twitter:description content="How Azure Cloud Shell stores your files"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.bathysphere.org/p/how-azure-cloud-shell-stores-your-files/csfiles.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/pumpking_xs_hu_bd62e3b8dade0638.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Bathysphere.org</a></h1><h2 class=site-description>Don't take life so serious, it ain't nohow permanent</h2></div></header><ol class=menu-social><li><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.threads.net/@edyoung0 target=_blank title=Threads rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ephemeral-storage>Ephemeral Storage</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/how-azure-cloud-shell-stores-your-files/><img src=/p/how-azure-cloud-shell-stores-your-files/csfiles_hu_a62119b23b27749c.png srcset="/p/how-azure-cloud-shell-stores-your-files/csfiles_hu_a62119b23b27749c.png 800w, /p/how-azure-cloud-shell-stores-your-files/csfiles_hu_a85701101220a4b2.png 1600w" width=800 height=250 loading=lazy alt="Featured image of post How Azure Cloud Shell stores your files"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/how-azure-cloud-shell-stores-your-files/>How Azure Cloud Shell stores your files</a></h2><h3 class=article-subtitle>How Azure Cloud Shell stores your files</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 25, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><p>The official information on Cloud Shell&rsquo;s file storage is <a class=link href=https://docs.microsoft.com/en-us/azure/cloud-shell/persisting-shell-storage target=_blank rel=noopener>here</a>. It&rsquo;s good stuff, and covers most things you might like to know, take a look! This blog contains a few more behind-the-scenes details for the curious. NB: We might change this in the future, this isn&rsquo;t guaranteed.</p><p>We can see from the docs that all your files are stored in an Azure File Share which belongs to you, and which you select when you first start CLoud Shell. But how do those files map to the directory layout you see in Cloud Shell?</p><p>You can see that there are several mount points set up:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>edwin@Azure:~$ df -H
</span></span><span class=line><span class=cl>Filesystem                                                          Size  Used Avail Use% Mounted on
</span></span><span class=line><span class=cl>overlay                                                              52G   17G   36G  32% /
</span></span><span class=line><span class=cl>tmpfs                                                                68M     <span class=m>0</span>   68M   0% /dev
</span></span><span class=line><span class=cl>tmpfs                                                               2.1G     <span class=m>0</span>  2.1G   0% /sys/fs/cgroup
</span></span><span class=line><span class=cl>/dev/sda1                                                            52G   17G   36G  32% /home
</span></span><span class=line><span class=cl>shm                                                                  68M  8.2k   68M   1% /dev/shm
</span></span><span class=line><span class=cl>//csxxx.file.core.windows.net/cs-edyoung-microsoft-com-xxx          6.5G  5.4G  1.1G  84% /usr/csuser/clouddrive
</span></span><span class=line><span class=cl>tmpfs                                                               2.1G     <span class=m>0</span>  2.1G   0% /proc/acpi
</span></span><span class=line><span class=cl>tmpfs                                                               2.1G     <span class=m>0</span>  2.1G   0% /proc/scsi
</span></span><span class=line><span class=cl>tmpfs                                                               2.1G     <span class=m>0</span>  2.1G   0% /sys/firmware
</span></span><span class=line><span class=cl>/dev/loop0                                                          5.3G  1.3G  3.7G  27% /home/edwin
</span></span></code></pre></td></tr></table></div></div><p>You can ignore the overlay and tmpfs stuff, which is container voodoo.</p><p>The bits that matter:</p><ul><li><p>Inside Cloud Shell, you have a classic Unix filesystem. Under the filesystem root <code>/</code>, most everything is owned by root, and is not writable by the Cloud Shell user. This includes all the utility programs Cloud Shell ships.
Even if you find some way to elevate privileges and update them, all the changes will be lost the next time you run Cloud Shell, because these are part of the container image, and are recreated every time you reconnect.</p></li><li><p>There&rsquo;s also your &lsquo;cloud drive&rsquo;, which is your Azure File Share mounted as a CIFS filesystem as <code>/usr/csuser/clouddrive</code>. In this example, mine is in the file share <code>cs-edyoung-microsoft-com-xxx</code> in the storage account <code>csxxx.file.core.windows.net</code> There&rsquo;s a symlink set up so that ~/clouddrive goes to the same location. Through that you can read and write files to the Azure file share.</p></li><li><p>Your home directory is different. It&rsquo;s under <code>/home/username</code> (mine is <code>/home/edwin</code> ) and is writable. You can see that is a mount point for <code>/dev/loop0</code>, which is a loopback filesystem. A loopback filesystem allows you to create a filesystem <em>inside a file</em>. Where is that file? Inside your cloud drive fileshare, as a regular file <code>.cloudconsole/acc_username.img</code></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>edwin@Azure:~$ ls -l ~/clouddrive/.cloudconsole/acc_edwin.img
</span></span><span class=line><span class=cl>-rwxrwxrwx <span class=m>1</span> edwin edwin <span class=m>5368709120</span> May <span class=m>26</span> 06:25 /home/edwin/clouddrive/.cloudconsole/acc_edwin.img
</span></span></code></pre></td></tr></table></div></div><p>You can see this is a 5GB file. Inside that file is an entire filesystem, which contains the files which you have stored in your home directory. <strong>Don&rsquo;t delete or modify that file, or you&rsquo;ll lose whatever you have in your Cloud Shell home directory</strong>. Generally you should treat this file as opaque, but if you desperately want to you could download the file and mount it as a loopback device on a regular Linux box. If for some reason you <em>want</em> to delete everything in your home directory, you could delete that file from the file share, and when you restart Cloud Shell we will create a new home directory file for you.</p><h2 id=ephemeral-storage>Ephemeral Storage</h2><p>If you are using Cloud Shell in ephemeral mode, then your home directory is just part of the container image, and everything in it will disappear when your session ends.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/azure/>Azure</a>
<a href=/tags/cloudshell/>CloudShell</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/cloud-shell-auth/><div class=article-image><img src=/p/cloud-shell-auth/agenda.900028a35495d726b9230c8c482a76f2_hu_62f584c41be74ba.png width=250 height=150 loading=lazy alt="Featured image of post Azure Cloud Shell, az login, and Managed Identity" data-key=cloud-shell-auth data-hash="md5-kAAoo1SV1ya5IwyMSCp28g=="></div><div class=article-details><h2 class=article-title>Azure Cloud Shell, az login, and Managed Identity</h2></div></a></article><article class=has-image><a href=/p/cloud-shell-installs/><div class=article-image><img src=/p/cloud-shell-installs/image.86d0656c95f65c095a182d1515f30cf4_hu_a0a413aea785ba54.png width=250 height=150 loading=lazy alt="Featured image of post How to install your own versions of tools in Azure Cloud Shell" data-key=cloud-shell-installs data-hash="md5-htBlbJX2XAlaGC0VFfMM9A=="></div><div class=article-details><h2 class=article-title>How to install your own versions of tools in Azure Cloud Shell</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Bathysphere.org</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>